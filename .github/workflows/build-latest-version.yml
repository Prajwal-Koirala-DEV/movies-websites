# Name of the workflow
name: Construct Most Recent Release

# Define the events that trigger the workflow
on:
  schedule:
    - cron: "0 0 * * *"
  # Allow manual triggering of the workflow
  workflow_dispatch:
# Define the jobs in the workflow
jobs:
  # Define a job named "build"
  build:
    # Name of the job that will be displayed on GitHub
    name: Build on Ubuntu
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    # Environment variables available to all steps in the job
    env:
      README_MD_FILE: readme.md
    # Define the steps in the job
    steps:
      # Check out the repository code
      - name: Check out Repository Code
        uses: actions/checkout@v4
      # Install required tools
      - name: Install Required Tools
        run: sudo apt-get update && sudo apt-get install curl -y
      - name: Get the current version of Go from project.
        uses: actions/setup-go@v5
        with:
          go-version-file: "go.mod"
          cache: true
          check-latest: true
        id: go
      # Run the golang stuff.
      - name: Run the golang project.
        run: go run .
      # Install and run prettier to format the files.
      - name: Install prettier via NPM.
        run: npm install -g prettier
      - name: Format the files using prettier
        run: npx prettier . --write
      # Push the updated file to GitHub
      - name: Push updated readme.md
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          if git diff --exit-code --quiet -- "${{ env.README_MD_FILE }}"; then
            echo "Nothing to update!"
            exit 0
          else
            git add "${{ env.README_MD_FILE }}"
            git commit -m "Updated readme.md on $(date)"
            git push
          fi
